<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Vault Store â€” Tienda</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    /* --- Estilos base (mantengo estÃ©tica "gamer" pero mÃ¡s neutra) --- */
    :root{
      --bg:#0a0a0a;
      --accent:#00ffe7;
      --card:#191921;
      --muted:#252c44;
      --glass:#11131a;
      --text:#F5FAFF;
      --success:#25c26a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Press Start 2P',Arial, sans-serif;
      background: linear-gradient(180deg,#050507 0%, #0a0a0a 100%);
      color:var(--text);
      min-height:100vh;
      -webkit-font-smoothing:antialiased;
    }
    header{
      background: #08090d;
      padding:1.2rem 1.4rem;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
      box-shadow:0 2px 20px #000a;
    }
    header h1{
      margin:0;
      font-family:'Orbitron','Press Start 2P',Arial;
      font-size:1.6rem;
      color:var(--accent);
      letter-spacing:1.5px;
    }
    .controls{
      display:flex;
      gap:0.6rem;
      align-items:center;
    }
    .btn{
      appearance:none;
      border:0;
      padding:0.5rem 0.9rem;
      border-radius:8px;
      background:linear-gradient(90deg,var(--accent) 60%, #00535a 100%);
      color:#061018;
      font-weight:700;
      cursor:pointer;
      font-family:'Orbitron',Arial;
      transition:transform .12s, box-shadow .12s;
    }
    .btn:active{transform:translateY(1px)}
    .search-box{
      margin:0.9rem auto;
      max-width:1200px;
      display:flex;
      gap:0.6rem;
      padding:0 1rem;
      align-items:center;
      justify-content:space-between;
    }
    .search-box input[type="search"]{
      width:60%;
      min-width:220px;
      padding:0.6rem 0.9rem;
      border-radius:8px;
      border:0;
      background:#0d121a;
      color:var(--accent);
      font-family:'Orbitron',Arial;
      font-size:0.95rem;
    }
    .filters{
      display:flex;
      gap:0.5rem;
      align-items:center;
    }
    select, .small-btn{
      padding:0.45rem 0.65rem;
      border-radius:8px;
      background:#141726;
      color:var(--text);
      border:1px solid var(--muted);
      font-family:'Orbitron',Arial;
      font-size:0.9rem;
    }

    .catalogo{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:1.6rem;
      padding:1.6rem;
      max-width:1200px;
      margin:0 auto 3rem;
    }
    .card{
      background:var(--card);
      border-radius:14px;
      padding:1rem;
      text-align:center;
      border:2px solid var(--muted);
      transition:transform .15s, box-shadow .15s, border-color .12s;
      position:relative;
      overflow:hidden;
    }
    .card:hover{ transform:translateY(-6px) scale(1.01); border-color:var(--accent); box-shadow:0 8px 28px #00ffd022;}
    .card img{ width:100%; height:140px; object-fit:contain; background:#0b0b0b; border-radius:10px; padding:6px;}
    .precio-sticker{
      display:inline-block;
      margin:0.5rem 0;
      padding:0.35rem 0.9rem;
      border-radius:10px;
      background:linear-gradient(90deg,var(--accent) 60%,#00535a 100%);
      color:#061018;
      font-family:'Orbitron';
      font-weight:700;
    }
    .cantidad-selector{ display:flex; gap:0.6rem; align-items:center; justify-content:center; margin-top:0.6rem;}
    .cantidad-selector input{ width:3rem; text-align:center; padding:0.2rem; border-radius:6px; background:#20283a; color:#fff; border:1px solid var(--muted); font-family:'Orbitron';}

    /* paneles */
    #detalle, #carrito, #factura{ max-width:760px; margin:1.6rem auto; background:var(--glass); padding:1rem; border-radius:12px; display:none; border:1px solid #222b3b; }
    #carrito ul{ list-style:none; padding:0; margin:0.8rem 0; max-height:300px; overflow:auto;}
    #carrito li{ display:flex; justify-content:space-between; gap:0.6rem; align-items:center; background:#14141b; padding:0.6rem; border-radius:8px; margin-bottom:0.6rem;}
    .eliminar{ background:#e57373; border:0; padding:0.35rem 0.6rem; border-radius:6px; cursor:pointer; color:#fff; }
    .msg{ position:fixed; right:1rem; bottom:1rem; background:linear-gradient(90deg,var(--success),#0b7f4b); padding:0.7rem 1rem; border-radius:10px; color:#061018; font-weight:700; display:none; }

    @media (max-width:700px){
      header h1{ font-size:1.05rem }
      .search-box input[type="search"]{ width:100% }
      .search-box{ flex-direction:column; gap:0.6rem; align-items:stretch; padding:0.8rem 1rem;}
      .controls{ width:100%; justify-content:flex-end }
    }
  </style>
</head>
<body>
  <header>
    <h1>Vault Store</h1>
    <div class="controls">
      <button class="btn" type="button" onclick="mostrarCarrito()" aria-label="Abrir carrito">ðŸ›’ Carrito</button>
    </div>
  </header>

  <div class="search-box" role="region" aria-label="BÃºsqueda y filtros">
    <input id="buscador" type="search" placeholder="Buscar producto, categorÃ­a o descr..." oninput="filtrarCatalogo()" aria-label="Buscar productos">
    <div class="filters">
      <select id="filtroCategoria" onchange="filtrarCatalogo()">
        <option value="">Todas las categorÃ­as</option>
      </select>
      <select id="orden" onchange="ordenarCatalogo()">
        <option value="relevancia">Orden: Relevancia</option>
        <option value="precio-asc">Precio: menor â†’ mayor</option>
        <option value="precio-desc">Precio: mayor â†’ menor</option>
      </select>
    </div>
  </div>

  <section id="catalogo" class="catalogo" aria-live="polite"></section>

  <section id="detalle" aria-live="polite"></section>

  <section id="carrito" aria-live="polite">
    <h2>Carrito de compras</h2>
    <ul id="listaCarrito"></ul>
    <p><strong>Total: $<span id="total">0.00</span></strong></p>
    <div style="display:flex;gap:0.6rem;flex-wrap:wrap;">
      <button class="btn" type="button" onclick="volverCatalogo()">Seguir viendo</button>
      <button class="btn" type="button" id="btnCompra" onclick="mostrarFormularioCompra()">Confirmar compra</button>
    </div>

    <form id="formCompra" style="display:none;margin-top:1rem;" onsubmit="return procesarCompra(event)" class="form-compra" aria-label="Formulario de compra">
      <input id="nombre" placeholder="Nombre completo" required />
      <input id="email" type="email" placeholder="Email" required />
      <input id="celular" placeholder="Celular" pattern="[0-9]{7,15}" required />
      <button class="btn" type="submit">Finalizar compra</button>
    </form>
  </section>

  <section id="factura" aria-live="polite"></section>

  <div id="mensaje" class="msg" role="status" aria-live="polite"></div>

<script>
  // --- Datos de ejemplo: ahora "productos" genÃ©ricos, precios numÃ©ricos, categorÃ­a y stock ---
  const productos = [
    {
      id: 1,
      titulo: "Auriculares Gamer V2",
      precio: 49.99,
      imagen: "imagenes/auriculares.jpg",
      descripcion: "Auriculares con micrÃ³fono, sonido envolvente y RGB.",
      categoria: "Accesorios",
      stock: 25,
      sku: "AC-001"
    },
    {
      id: 2,
      titulo: "Teclado MecÃ¡nico TKL",
      precio: 89.90,
      imagen: "imagenes/teclado.jpg",
      descripcion: "Switches azules, retroiluminaciÃ³n y diseÃ±o compacto.",
      categoria: "Accesorios",
      stock: 14,
      sku: "AC-002"
    },
    {
      id: 3,
      titulo: "Monitor 27\" 144Hz",
      precio: 249.00,
      imagen: "imagenes/monitor.jpg",
      descripcion: "Pantalla IPS 144Hz para juegos y productividad.",
      categoria: "Hardware",
      stock: 8,
      sku: "HW-010"
    },
    {
      id: 4,
      titulo: "MembresÃ­a Premium (1 mes)",
      precio: 0.00,
      imagen: "imagenes/membresia.jpg",
      descripcion: "Prueba gratuita o promociÃ³n: descripciÃ³n breve.",
      categoria: "Servicios",
      stock: 9999,
      sku: "SV-100"
    }
  ];

  // --- Estado y referencias DOM ---
  const catalogoEl = document.getElementById('catalogo');
  const detalleEl = document.getElementById('detalle');
  const carritoEl = document.getElementById('carrito');
  const facturaEl = document.getElementById('factura');
  const listaCarritoEl = document.getElementById('listaCarrito');
  const totalEl = document.getElementById('total');
  const buscador = document.getElementById('buscador');
  const filtroCategoria = document.getElementById('filtroCategoria');
  const ordenSelect = document.getElementById('orden');
  const mensaje = document.getElementById('mensaje');
  let carritoItems = JSON.parse(localStorage.getItem('carrito')) || [];
  let catalogoFiltrado = [...productos];

  // --- InicializaciÃ³n de filtros (categorÃ­as dinÃ¡micas) ---
  function initFiltros(){
    const categorias = Array.from(new Set(productos.map(p=>p.categoria))).sort();
    categorias.forEach(cat=>{
      const opt = document.createElement('option');
      opt.value = cat;
      opt.textContent = cat;
      filtroCategoria.appendChild(opt);
    });
  }

  // --- Mostrar catÃ¡logo ---
  function mostrarCatalogo(){
    catalogoEl.style.display = 'grid';
    detalleEl.style.display = 'none';
    carritoEl.style.display = 'none';
    facturaEl.style.display = 'none';
    catalogoEl.innerHTML = '';
    if(catalogoFiltrado.length === 0){
      catalogoEl.innerHTML = `<p style="font-family:Orbitron;color:var(--accent);text-align:center;">No se encontraron productos.</p>`;
      return;
    }
    catalogoFiltrado.forEach(prod=>{
      const card = document.createElement('article');
      card.className = 'card';
      card.setAttribute('tabindex','0');
      card.innerHTML = `
        <img src="${prod.imagen}" alt="${escapeHtml(prod.titulo)}">
        <h3 style="margin:.6rem 0 .2rem 0;color:var(--accent);font-size:.95rem">${escapeHtml(prod.titulo)}</h3>
        <div class="precio-sticker">${formatPrecio(prod.precio)}</div>
        <p style="font-size:.78rem; color:#cfe8ff; min-height:2.2em">${escapeHtml(prod.descripcion)}</p>
        <div style="margin-top:.6rem;font-size:.78rem;color:#bcd">${escapeHtml(prod.categoria)} â€¢ SKU ${escapeHtml(prod.sku)}</div>
        <div class="cantidad-selector" onclick="event.stopPropagation()">
          <button class="small-btn" type="button" onclick="cambiarCantidad(this,-1)">-</button>
          <input type="number" value="1" min="1" max="${prod.stock}" aria-label="Cantidad">
          <button class="small-btn" type="button" onclick="cambiarCantidad(this,1)">+</button>
        </div>
        <div style="display:flex;gap:.5rem;justify-content:center;margin-top:.7rem">
          <button class="btn" type="button" onclick="agregarDesdeCatalogo(event, ${prod.id}, this)">Agregar</button>
          <button class="btn" type="button" onclick="verDetalle(${prod.id})">Ver</button>
        </div>
      `;
      // abrir detalle con tecla Enter
      card.addEventListener('keydown', e=>{
        if(e.key === 'Enter') verDetalle(prod.id);
      });
      catalogoEl.appendChild(card);
    });
  }

  // --- Utilidades ---
  function formatPrecio(num){
    return num === 0 ? 'Gratis' : `$${Number(num).toFixed(2)}`;
  }
  function escapeHtml(str){
    return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
  }

  // --- Buscador / filtros / orden ---
  function filtrarCatalogo(){
    const q = buscador.value.trim().toLowerCase();
    const cat = filtroCategoria.value;
    catalogoFiltrado = productos.filter(p=>{
      const matchQ = q === '' || p.titulo.toLowerCase().includes(q) || p.descripcion.toLowerCase().includes(q) || p.categoria.toLowerCase().includes(q);
      const matchCat = !cat || p.categoria === cat;
      return matchQ && matchCat;
    });
    ordenarCatalogo(); // aplicar orden tras filtrar
  }

  function ordenarCatalogo(){
    const mode = ordenSelect.value;
    if(mode === 'precio-asc') catalogoFiltrado.sort((a,b)=>a.precio - b.precio);
    else if(mode === 'precio-desc') catalogoFiltrado.sort((a,b)=>b.precio - a.precio);
    // relevancia o default mantiene orden original
    mostrarCatalogo();
  }

  // --- Cantidad en tarjetas ---
  function cambiarCantidad(btn, delta){
    const input = btn.parentElement.querySelector('input[type=number]');
    let val = parseInt(input.value,10) || 1;
    val += delta;
    if(val < 1) val = 1;
    if(input.max) val = Math.min(val, parseInt(input.max,10));
    input.value = val;
  }

  // --- Agregar al carrito (desde catÃ¡logo y detalle) ---
  function agregarDesdeCatalogo(e, id, btn){
    e.stopPropagation();
    const card = btn.closest('.card');
    const input = card.querySelector('input[type=number]');
    const cantidad = Math.max(1, parseInt(input.value,10) || 1);
    agregarCarrito(id, cantidad);
    input.value = 1;
  }

  function verDetalle(id){
    const prod = productos.find(p=>p.id===id);
    if(!prod) return;
    catalogoEl.style.display = 'none';
    carritoEl.style.display = 'none';
    facturaEl.style.display = 'none';
    detalleEl.style.display = 'block';
    detalleEl.innerHTML = `
      <h2 style="color:var(--accent)">${escapeHtml(prod.titulo)}</h2>
      <img src="${prod.imagen}" alt="${escapeHtml(prod.titulo)}" style="max-width:360px;display:block;margin:0.6rem auto;border-radius:8px">
      <div class="precio-sticker">${formatPrecio(prod.precio)}</div>
      <p style="color:#cfe8ff">${escapeHtml(prod.descripcion)}</p>
      <p style="color:#bcd">CategorÃ­a: ${escapeHtml(prod.categoria)} â€¢ SKU ${escapeHtml(prod.sku)} â€¢ Stock: ${prod.stock}</p>
      <div class="cantidad-selector">
        <button class="small-btn" type="button" onclick="cambiarCantidad(this,-1)">-</button>
        <input type="number" value="1" min="1" max="${prod.stock}">
        <button class="small-btn" type="button" onclick="cambiarCantidad(this,1)">+</button>
      </div>
      <div style="display:flex;gap:.6rem;justify-content:center;margin-top:.8rem">
        <button class="btn" type="button" onclick="agregarDesdeDetalle(event, ${prod.id}, this)">Agregar al carrito</button>
        <button class="btn" type="button" onclick="mostrarCatalogo()">Volver</button>
      </div>
    `;
    setTimeout(()=>window.scrollTo(0,0),50);
  }

  function agregarDesdeDetalle(e, id, btn){
    e.stopPropagation();
    const input = btn.parentElement.parentElement.querySelector('input[type=number]');
    const cantidad = Math.max(1, parseInt(input.value,10) || 1);
    agregarCarrito(id, cantidad);
    input.value = 1;
  }

  function agregarCarrito(id, cantidad){
    const prod = productos.find(p=>p.id===id);
    if(!prod) return;
    const idx = carritoItems.findIndex(it=>it.id===id);
    if(idx >= 0){
      carritoItems[idx].cantidad = Math.min(prod.stock, carritoItems[idx].cantidad + cantidad);
    } else {
      carritoItems.push({ id:prod.id, titulo:prod.titulo, precio:prod.precio, cantidad: Math.min(cantidad, prod.stock) });
    }
    guardarCarrito();
    mostrarMensaje(`${prod.titulo} x${cantidad} agregado al carrito`);
  }

  // --- Carrito: mostrar / actualizar / eliminar ---
  function mostrarCarrito(){
    catalogoEl.style.display = 'none';
    detalleEl.style.display = 'none';
    facturaEl.style.display = 'none';
    carritoEl.style.display = 'block';
    renderCarrito();
  }

  function renderCarrito(){
    listaCarritoEl.innerHTML = '';
    let total = 0;
    carritoItems.forEach((item, idx)=>{
      const subtotal = item.precio * item.cantidad;
      total += subtotal;
      const li = document.createElement('li');
      li.innerHTML = `
        <div style="flex:1">
          <div style="font-weight:700">${escapeHtml(item.titulo)}</div>
          <div style="color:#bcd;font-size:.9rem">${formatPrecio(item.precio)} â€¢ Subtotal: ${formatPrecio(subtotal)}</div>
        </div>
        <div style="display:flex;align-items:center;gap:.5rem">
          <input aria-label="Cantidad producto" type="number" min="1" value="${item.cantidad}" style="width:3rem;padding:.25rem;border-radius:6px;background:#20283a;color:#fff;border:1px solid var(--muted)" onchange="actualizarCantidad(${idx}, this.value)">
          <button class="eliminar" onclick="eliminarDelCarrito(${idx})">âœ–</button>
        </div>
      `;
      listaCarritoEl.appendChild(li);
    });
    totalEl.textContent = Number(total).toFixed(2);
    document.getElementById('btnCompra').style.display = carritoItems.length ? 'inline-block' : 'none';
  }

  function actualizarCantidad(index, valor){
    let val = parseInt(valor,10) || 1;
    if(val < 1) val = 1;
    carritoItems[index].cantidad = val;
    guardarCarrito();
    renderCarrito();
  }

  function eliminarDelCarrito(index){
    carritoItems.splice(index,1);
    guardarCarrito();
    renderCarrito();
  }

  function guardarCarrito(){
    localStorage.setItem('carrito', JSON.stringify(carritoItems));
  }

  // --- Proceso de compra simplificado (simulaciÃ³n) ---
  function mostrarFormularioCompra(){
    if(carritoItems.length === 0) return mostrarMensaje('El carrito estÃ¡ vacÃ­o', true);
    document.getElementById('formCompra').style.display = 'block';
  }

  function procesarCompra(e){
    e.preventDefault();
    const nombre = document.getElementById('nombre').value.trim();
    const email = document.getElementById('email').value.trim();
    const celular = document.getElementById('celular').value.trim();
    if(!nombre || !email || !celular) return mostrarMensaje('Completa los datos requeridos', true);
    // Generar "factura"
    let total = 0;
    let itemsHtml = '';
    carritoItems.forEach(it=>{
      const subtotal = it.precio * it.cantidad;
      total += subtotal;
      itemsHtml += `<li>${escapeHtml(it.titulo)} x${it.cantidad} - ${formatPrecio(subtotal)}</li>`;
    });
    facturaEl.innerHTML = `
      <h2 style="color:var(--accent)">Factura</h2>
      <div style="background:#0e1622;padding:1rem;border-radius:8px;margin-top:.6rem">
        <strong>Nombre:</strong> ${escapeHtml(nombre)} <br>
        <strong>Email:</strong> ${escapeHtml(email)} <br>
        <strong>Celular:</strong> ${escapeHtml(celular)} <br><br>
        <strong>Productos:</strong>
        <ul>${itemsHtml}</ul>
        <strong>Total pagado:</strong> ${formatPrecio(total)}
      </div>
      <div style="margin-top:.8rem;display:flex;gap:.6rem">
        <button class="btn" type="button" onclick="finalizarCompra()">Finalizar</button>
        <button class="btn" type="button" onclick="imprimirFactura()">Imprimir</button>
      </div>
    `;
    facturaEl.style.display = 'block';
    carritoEl.style.display = 'none';
    carritoItems = [];
    guardarCarrito();
    document.getElementById('formCompra').reset();
    document.getElementById('formCompra').style.display = 'none';
    mostrarMensaje('Compra procesada con Ã©xito');
  }

  function finalizarCompra(){
    facturaEl.style.display = 'none';
    mostrarCatalogo();
  }
  function imprimirFactura(){
    window.print();
  }

  // --- UI mensajes ---
  let msgTimeout = null;
  function mostrarMensaje(text, error = false){
    mensaje.style.display = 'block';
    mensaje.style.background = error ? '#ef5350' : 'linear-gradient(90deg,var(--success),#0b7f4b)';
    mensaje.textContent = text;
    if(msgTimeout) clearTimeout(msgTimeout);
    msgTimeout = setTimeout(()=>{ mensaje.style.display = 'none'; }, 3000);
  }

  // --- Inicial --- 
  initFiltros();
  mostrarCatalogo();
</script>
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } 
    from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBoGgWvZvei2yBcIz0xvaudrCRtfXW4yRw",
    authDomain: "d-store-4ef98.firebaseapp.com",
    projectId: "d-store-4ef98",
    storageBucket: "d-store-4ef98.firebasestorage.app",
    messagingSenderId: "581887779684",
    appId: "1:581887779684:web:96be0a0f1d67b777b39071",
    measurementId: "G-D4674T98H3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // PROBAR:
  // agregarProducto();
  // mostrarProductos();

  async function agregarProducto() {
    await addDoc(collection(db, "productos"), {
      nombre: "Prueba",
      precio: 10
    });
    alert("Producto guardado!");
  }

  async function mostrarProductos() {
    const snap = await getDocs(collection(db, "productos"));
    snap.forEach(doc => console.log(doc.data()));
  }
</script>
</body>
</html>
